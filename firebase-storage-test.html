<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Storage Test</title>
</head>
<body>
    <h1>Firebase Storage Test - store-41d09</h1>
    <p><strong>Storage Bucket:</strong> gs://store-41d09.firebasestorage.app</p>
    <input type="file" id="fileInput" accept="image/*" multiple>
    <button onclick="testUpload()">Test Upload</button>
    <button onclick="testConnection()">Test Connection Only</button>
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD2_g2V6PkhmuXz0yh1byPliyYMGe0ZGgA",
            authDomain: "store-41d09.firebaseapp.com",
            projectId: "store-41d09",
            storageBucket: "store-41d09.firebasestorage.app",
            messagingSenderId: "21802581957",
            appId: "1:21802581957:web:fdd712534687d6093bd5ac",
            measurementId: "G-LQRQ9TJ0P5"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        window.testConnection = async function() {
            const results = document.getElementById('results');
            
            try {
                results.innerHTML = '<p>Testing Firebase Storage connection...</p>';
                
                // Simple test - just try to create a storage reference
                const testRef = ref(storage, 'test/connection-test.txt');
                console.log('Storage reference created successfully:', testRef);
                
                results.innerHTML = '<p style="color: green;">✅ Firebase Storage connection successful!</p>';
                
            } catch (error) {
                console.error('Connection test failed:', error);
                results.innerHTML = `
                    <p style="color: red;">❌ Connection failed!</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Code:</strong> ${error.code}</p>
                `;
            }
        };

        window.testUpload = async function() {
            const fileInput = document.getElementById('fileInput');
            const results = document.getElementById('results');
            
            if (!fileInput.files[0]) {
                results.innerHTML = '<p style="color: red;">Please select a file first!</p>';
                return;
            }

            try {
                results.innerHTML = '<p>Testing upload...</p>';
                
                const files = Array.from(fileInput.files);
                const uploadResults = [];
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    results.innerHTML = `<p>Uploading file ${i + 1}/${files.length}: ${file.name}...</p>`;
                    
                    const storageRef = ref(storage, 'products/test_' + Date.now() + '_' + i + '_' + file.name);
                    
                    console.log('Uploading file:', file.name);
                    const snapshot = await uploadBytes(storageRef, file);
                    
                    console.log('Upload successful, getting download URL...');
                    const downloadURL = await getDownloadURL(snapshot.ref);
                    
                    uploadResults.push({
                        name: file.name,
                        url: downloadURL
                    });
                }
                
                let resultHtml = '<p style="color: green;">✅ All uploads successful!</p>';
                uploadResults.forEach((result, index) => {
                    resultHtml += `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">
                            <p><strong>File ${index + 1}:</strong> ${result.name}</p>
                            <p><strong>URL:</strong> <a href="${result.url}" target="_blank">${result.url}</a></p>
                            <img src="${result.url}" style="max-width: 200px; max-height: 200px;" alt="Uploaded image">
                        </div>
                    `;
                });
                
                results.innerHTML = resultHtml;
                
            } catch (error) {
                console.error('Upload failed:', error);
                results.innerHTML = `
                    <p style="color: red;">❌ Upload failed!</p>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Code:</strong> ${error.code}</p>
                    <p><strong>Details:</strong> Check browser console for more info</p>
                `;
            }
        };
    </script>
</body>
</html>